<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini-App</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>

  <div class="top">
    <div class="logo"><img id="shopLogo" alt=""></div>
    <div style="font-weight:900;font-size:18px" id="shopName">Mini-App</div>
  </div>

  <div class="filters">
    <select id="catSelect"><option value="">Toutes les cat√©gories</option></select>
    <select id="brandSelect"><option value="">Toutes les farms</option></select>
  </div>

  <div class="grid" id="grid"></div>
  <div class="spacer"></div>

  <div class="bottom-bar">
    <div class="tab"><b>Menu</b></div>
    <div class="tab"><b>Infos</b></div>
    <div class="tab"><b>Canal</b></div>
    <div class="tab"><b>Contact</b></div>
  </div>

<script>
  let DATA;
  function uniq(arr){ return [...new Set(arr.filter(Boolean))].sort(); }

  function render(){
    const cat = document.getElementById('catSelect').value;
    const brand = document.getElementById('brandSelect').value;

    const list = DATA.products.filter(p=>{
      if(cat && p.category!==cat) return false;
      if(brand && p.brand!==brand) return false;
      return true;
    });

    const grid = document.getElementById('grid');
    grid.innerHTML = "";

    list.forEach(p=>{
      const card = document.createElement('div');
      card.className = "card";
      card.onclick = ()=> location.href = `product.html?id=${encodeURIComponent(p.id)}`;

      card.innerHTML = `
        <div class="tag">üè∑Ô∏è ${p.category || ""}</div>
        <div class="img"><img src="${p.image || ""}" alt=""></div>
        <div class="body">
          <p class="name">${p.name || ""}</p>
          <p class="sub">üïµÔ∏è ${p.brand || ""}</p>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  (async ()=>{
    const res = await fetch('products.json', {cache:'no-store'});
    DATA = await res.json();

    document.getElementById('shopName').textContent = DATA.shopName || "Mini-App";
    // tu peux mettre ton logo via URL dans products.json si tu veux, sinon √ßa reste vide
    // document.getElementById('shopLogo').src = DATA.shopLogo || "";

    const cats = uniq(DATA.products.map(p=>p.category));
    const brands = uniq(DATA.products.map(p=>p.brand));

    const catSelect = document.getElementById('catSelect');
    cats.forEach(c=>{
      const o = document.createElement('option'); o.value=c; o.textContent=c;
      catSelect.appendChild(o);
    });

    const brandSelect = document.getElementById('brandSelect');
    brands.forEach(b=>{
      const o = document.createElement('option'); o.value=b; o.textContent=b;
      brandSelect.appendChild(o);
    });

    catSelect.onchange = render;
    brandSelect.onchange = render;

    render();
  })();
</script>
</body>
</html>
